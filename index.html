<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academia de Danza - Sistema de Gesti√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 15px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #dee2e6;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .payment-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 0 0 50%;
            }
        }

        .grupo-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .grupo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .grupo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .grupo-nombre {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
        }

        .grupo-info {
            margin-bottom: 10px;
            color: #495057;
        }

        .grupo-alumnas {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
        }

        .alumna-item {
            display: inline-block;
            background: white;
            padding: 5px 12px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
            border: 1px solid #dee2e6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 20px;
        }

        .close-modal {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #6c757d;
        }

        .checkbox-group {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
        }

        .checkbox-item {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .checkbox-item:last-child {
            border-bottom: none;
        }

        .checkbox-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 0;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .ticket-preview {
            background: white;
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }

        #ticketCanvas {
            max-width: 100%;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .ticket-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .logo-upload {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 100px;
            margin-top: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü©∞ Academia de Danza</h1>
            <p>Sistema de Gesti√≥n Integral</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('alumnas')">üëß Alumnas</button>
            <button class="tab" onclick="showTab('grupos')">üë• Grupos</button>
            <button class="tab" onclick="showTab('asistencia')">‚úì Asistencia</button>
            <button class="tab" onclick="showTab('mensualidades')">üí∞ Mensualidades</button>
            <button class="tab" onclick="showTab('productos')">üõçÔ∏è Productos</button>
            <button class="tab" onclick="showTab('reportes')">üìä Reportes</button>
        </div>

        <div class="content">
            <!-- PESTA√ëA ALUMNAS -->
            <div id="alumnas" class="tab-content active">
                <div class="card">
                    <div class="card-header">Registrar Nueva Alumna</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Nombre Completo</label>
                            <input type="text" id="nombreAlumna" placeholder="Ej: Mar√≠a Garc√≠a L√≥pez">
                        </div>
                        <div class="form-group">
                            <label>Edad</label>
                            <input type="number" id="edadAlumna" placeholder="Ej: 8">
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono de Contacto</label>
                            <input type="tel" id="telefonoAlumna" placeholder="Ej: 9931234567">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Inscripci√≥n</label>
                            <input type="date" id="fechaInscripcion">
                        </div>
                        <div class="form-group">
                            <label>Grupo</label>
                            <select id="grupoAlumna">
                                <option value="">-- Sin grupo --</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Observaciones</label>
                        <textarea id="observaciones" rows="3" placeholder="Alergias, condiciones m√©dicas, etc."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="registrarAlumna()">Registrar Alumna</button>
                </div>

                <div class="card">
                    <div class="card-header">Listado de Alumnas</div>
                    <table id="tablaAlumnas">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Edad</th>
                                <th>Grupo</th>
                                <th>Tel√©fono</th>
                                <th>Fecha Inscripci√≥n</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaAlumnas"></tbody>
                    </table>
                </div>
            </div>

            <!-- PESTA√ëA GRUPOS -->
            <div id="grupos" class="tab-content">
                <div class="card">
                    <div class="card-header">Crear Nuevo Grupo</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Nombre del Grupo</label>
                            <input type="text" id="nombreGrupo" placeholder="Ej: Ballet Principiantes, Jazz Avanzado">
                        </div>
                        <div class="form-group">
                            <label>Horario</label>
                            <input type="text" id="horarioGrupo" placeholder="Ej: Lunes y Mi√©rcoles 4:00 PM">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Descripci√≥n</label>
                        <textarea id="descripcionGrupo" rows="2" placeholder="Descripci√≥n del grupo, nivel, etc."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="crearGrupo()">Crear Grupo</button>
                </div>

                <div class="card">
                    <div class="card-header">Grupos Existentes</div>
                    <div id="listaGrupos"></div>
                </div>
            </div>

            <!-- PESTA√ëA ASISTENCIA -->
            <div id="asistencia" class="tab-content">
                <div class="card">
                    <div class="card-header">Registro de Asistencia</div>
                    <div class="form-group">
                        <label>Fecha</label>
                        <input type="date" id="fechaAsistencia">
                    </div>
                    <div class="form-group">
                        <label>Seleccionar Alumna</label>
                        <select id="alumnaAsistencia">
                            <option value="">-- Seleccione una alumna --</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="marcarAsistencia()">‚úì Marcar Asistencia</button>
                </div>

                <div class="card">
                    <div class="card-header">Historial de Asistencia</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Alumna</th>
                            </tr>
                        </thead>
                        <tbody id="listaAsistencia"></tbody>
                    </table>
                </div>
            </div>

            <!-- PESTA√ëA MENSUALIDADES -->
            <div id="mensualidades" class="tab-content">
                <div class="card">
                    <div class="card-header">Registrar Pago de Mensualidad</div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Alumna</label>
                            <select id="alumnaMensualidad" onchange="mostrarHistorialPagos()">
                                <option value="">-- Seleccione una alumna --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Mes/Periodo</label>
                            <input type="text" id="periodoMensualidad" placeholder="Ej: Enero 2026, Mensualidad 1">
                        </div>
                        <div class="form-group">
                            <label>Monto</label>
                            <input type="number" id="montoMensualidad" placeholder="Ej: 500">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Pago</label>
                            <input type="date" id="fechaMensualidad">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="registrarMensualidad()">Registrar Pago</button>
                    <button class="btn btn-success" onclick="generarTicketMensualidad()">Generar Ticket de Pago</button>
                </div>

                <div class="card" id="historialPagosCard" style="display: none;">
                    <div class="card-header">Historial de Pagos - <span id="nombreAlumnaHistorial"></span></div>
                    <div id="historialPagos"></div>
                </div>

                <div class="card">
                    <div class="card-header">Todas las Mensualidades</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Alumna</th>
                                <th>Periodo</th>
                                <th>Monto</th>
                                <th>Fecha de Pago</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaMensualidades"></tbody>
                    </table>
                </div>
            </div>

            <!-- PESTA√ëA PRODUCTOS -->
            <div id="productos" class="tab-content">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">Agregar Producto al Inventario</div>
                        <div class="form-group">
                            <label>Nombre del Producto</label>
                            <input type="text" id="nombreProducto" placeholder="Ej: Mallas de danza">
                        </div>
                        <div class="form-group">
                            <label>Precio</label>
                            <input type="number" id="precioProducto" placeholder="Ej: 250">
                        </div>
                        <div class="form-group">
                            <label>Stock Disponible</label>
                            <input type="number" id="stockProducto" placeholder="Ej: 10">
                        </div>
                        <button class="btn btn-primary" onclick="agregarProducto()">Agregar Producto</button>
                    </div>

                    <div class="card">
                        <div class="card-header">Registrar Venta</div>
                        <div class="form-group">
                            <label>Producto</label>
                            <select id="productoVenta">
                                <option value="">-- Seleccione un producto --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Alumna (opcional)</label>
                            <select id="alumnaVenta">
                                <option value="">-- Sin alumna asociada --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Cantidad</label>
                            <input type="number" id="cantidadVenta" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>Fecha de Venta</label>
                            <input type="date" id="fechaVenta">
                        </div>
                        <button class="btn btn-success" onclick="registrarVenta()">Registrar Venta</button>
                        <button class="btn btn-primary" onclick="generarTicketVenta()">Generar Ticket de Venta</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Inventario de Productos</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Precio</th>
                                <th>Stock</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaProductos"></tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">Historial de Ventas</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Producto</th>
                                <th>Cantidad</th>
                                <th>Total</th>
                                <th>Alumna</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="listaVentas"></tbody>
                    </table>
                </div>
            </div>

            <!-- PESTA√ëA REPORTES -->
            <div id="reportes" class="tab-content">
                <div class="card">
                    <div class="card-header">Configuraci√≥n del Logo</div>
                    <div class="logo-upload">
                        <label for="logoInput" class="btn btn-primary" style="cursor: pointer;">
                            üì∑ Seleccionar Logo de la Academia
                        </label>
                        <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="cargarLogo(event)">
                        <div id="logoPreviewContainer" style="margin-top: 15px;">
                            <p style="color: #6c757d;">No hay logo cargado</p>
                        </div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <h3 id="totalAlumnas">0</h3>
                        <p>Alumnas Registradas</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalMensualidades">$0</h3>
                        <p>Total Mensualidades</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalVentas">$0</h3>
                        <p>Total Ventas</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="totalIngresos">$0</h3>
                        <p>Ingresos Totales</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Estado de Pagos por Alumna</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Alumna</th>
                                <th>Mensualidades Pagadas</th>
                                <th>√öltimo Pago</th>
                                <th>Total Pagado</th>
                            </tr>
                        </thead>
                        <tbody id="reportePagos"></tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">Resumen de Asistencias</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Alumna</th>
                                <th>Total Asistencias</th>
                                <th>√öltima Asistencia</th>
                            </tr>
                        </thead>
                        <tbody id="reporteAsistencias"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar grupo -->
    <div id="modalEditarGrupo" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="cerrarModalGrupo()">&times;</span>
            <div class="modal-header">Editar Grupo</div>
            <input type="hidden" id="editarGrupoId">
            <div class="form-group">
                <label>Nombre del Grupo</label>
                <input type="text" id="editarNombreGrupo">
            </div>
            <div class="form-group">
                <label>Horario</label>
                <input type="text" id="editarHorarioGrupo">
            </div>
            <div class="form-group">
                <label>Descripci√≥n</label>
                <textarea id="editarDescripcionGrupo" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Alumnas del Grupo</label>
                <div class="checkbox-group" id="checkboxAlumnas"></div>
            </div>
            <button class="btn btn-primary" onclick="guardarEdicionGrupo()">Guardar Cambios</button>
            <button class="btn btn-danger" onclick="cerrarModalGrupo()">Cancelar</button>
        </div>
    </div>

    <!-- Modal para ticket -->
    <div id="modalTicket" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="cerrarModalTicket()">&times;</span>
            <div class="modal-header">Ticket de Compra</div>
            <div class="ticket-preview">
                <canvas id="ticketCanvas"></canvas>
            </div>
            <div class="ticket-actions">
                <button class="btn btn-primary" onclick="descargarTicket()">‚¨áÔ∏è Descargar PNG</button>
                <button class="btn btn-success" onclick="compartirWhatsApp()">üì± Compartir por WhatsApp</button>
                <button class="btn btn-danger" onclick="cerrarModalTicket()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // Inicializaci√≥n de datos
        let alumnas = [];
        let asistencias = [];
        let mensualidades = [];
        let productos = [];
        let ventas = [];
        let grupos = [];
        let idCounter = 1;
        let idProducto = 1;
        let idGrupo = 1;
        let logoAcademia = null;
        let ticketActual = null;

        // Cargar datos del localStorage al iniciar
        window.onload = function() {
            cargarDatos();
            document.getElementById('fechaAsistencia').valueAsDate = new Date();
            document.getElementById('fechaMensualidad').valueAsDate = new Date();
            document.getElementById('fechaVenta').valueAsDate = new Date();
            document.getElementById('fechaInscripcion').valueAsDate = new Date();
            actualizarTodo();
        };

        function cargarDatos() {
            const datosGuardados = localStorage.getItem('academiaDanza');
            if (datosGuardados) {
                const datos = JSON.parse(datosGuardados);
                alumnas = datos.alumnas || [];
                asistencias = datos.asistencias || [];
                mensualidades = datos.mensualidades || [];
                productos = datos.productos || [];
                ventas = datos.ventas || [];
                grupos = datos.grupos || [];
                idCounter = datos.idCounter || 1;
                idProducto = datos.idProducto || 1;
                idGrupo = datos.idGrupo || 1;
                logoAcademia = datos.logoAcademia || null;
                
                if (logoAcademia) {
                    mostrarLogoPreview();
                }
            }
        }

        function guardarDatos() {
            const datos = {
                alumnas,
                asistencias,
                mensualidades,
                productos,
                ventas,
                grupos,
                idCounter,
                idProducto,
                idGrupo,
                logoAcademia
            };
            localStorage.setItem('academiaDanza', JSON.stringify(datos));
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'reportes') {
                actualizarReportes();
            }
        }

        // GESTI√ìN DE ALUMNAS
        function registrarAlumna() {
            const nombre = document.getElementById('nombreAlumna').value;
            const edad = document.getElementById('edadAlumna').value;
            const telefono = document.getElementById('telefonoAlumna').value;
            const fechaInscripcion = document.getElementById('fechaInscripcion').value;
            const observaciones = document.getElementById('observaciones').value;
            const grupoId = parseInt(document.getElementById('grupoAlumna').value) || null;

            if (!nombre || !edad || !telefono || !fechaInscripcion) {
                alert('Por favor complete todos los campos obligatorios');
                return;
            }

            const alumna = {
                id: idCounter++,
                nombre,
                edad: parseInt(edad),
                telefono,
                fechaInscripcion,
                observaciones,
                grupoId
            };

            alumnas.push(alumna);
            guardarDatos();
            
            document.getElementById('nombreAlumna').value = '';
            document.getElementById('edadAlumna').value = '';
            document.getElementById('telefonoAlumna').value = '';
            document.getElementById('observaciones').value = '';
            document.getElementById('grupoAlumna').value = '';
            
            actualizarTodo();
            mostrarAlerta('Alumna registrada exitosamente', 'success');
        }

        function eliminarAlumna(id) {
            if (confirm('¬øEst√° seguro de eliminar esta alumna? Se eliminar√°n todos sus registros asociados.')) {
                alumnas = alumnas.filter(a => a.id !== id);
                asistencias = asistencias.filter(a => a.alumnaId !== id);
                mensualidades = mensualidades.filter(m => m.alumnaId !== id);
                guardarDatos();
                actualizarTodo();
                mostrarAlerta('Alumna eliminada', 'success');
            }
        }

        function actualizarListaAlumnas() {
            const tbody = document.getElementById('listaAlumnas');
            tbody.innerHTML = '';

            alumnas.forEach(alumna => {
                const grupo = grupos.find(g => g.id === alumna.grupoId);
                const nombreGrupo = grupo ? grupo.nombre : 'Sin grupo';
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${alumna.id}</td>
                    <td>${alumna.nombre}</td>
                    <td>${alumna.edad}</td>
                    <td><span class="badge badge-${grupo ? 'success' : 'warning'}">${nombreGrupo}</span></td>
                    <td>${alumna.telefono}</td>
                    <td>${new Date(alumna.fechaInscripcion).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-danger" onclick="eliminarAlumna(${alumna.id})">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function actualizarSelectsAlumnas() {
            const selects = ['alumnaAsistencia', 'alumnaMensualidad', 'alumnaVenta', 'grupoAlumna'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const valorActual = select.value;
                
                if (selectId === 'grupoAlumna') {
                    select.innerHTML = '<option value="">-- Sin grupo --</option>';
                    grupos.forEach(grupo => {
                        const option = document.createElement('option');
                        option.value = grupo.id;
                        option.textContent = grupo.nombre;
                        select.appendChild(option);
                    });
                } else {
                    select.innerHTML = selectId === 'alumnaVenta' 
                        ? '<option value="">-- Sin alumna asociada --</option>'
                        : '<option value="">-- Seleccione una alumna --</option>';
                    
                    alumnas.forEach(alumna => {
                        const option = document.createElement('option');
                        option.value = alumna.id;
                        option.textContent = alumna.nombre;
                        select.appendChild(option);
                    });
                }
                
                select.value = valorActual;
            });
        }

        // GESTI√ìN DE ASISTENCIA
        function marcarAsistencia() {
            const fecha = document.getElementById('fechaAsistencia').value;
            const alumnaId = parseInt(document.getElementById('alumnaAsistencia').value);

            if (!fecha || !alumnaId) {
                alert('Por favor complete todos los campos');
                return;
            }

            const alumna = alumnas.find(a => a.id === alumnaId);
            
            const asistencia = {
                fecha,
                alumnaId,
                nombreAlumna: alumna.nombre
            };

            asistencias.push(asistencia);
            guardarDatos();
            
            actualizarListaAsistencia();
            mostrarAlerta('Asistencia registrada', 'success');
        }

        function actualizarListaAsistencia() {
            const tbody = document.getElementById('listaAsistencia');
            tbody.innerHTML = '';

            const asistenciasOrdenadas = [...asistencias].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            asistenciasOrdenadas.forEach(asistencia => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${new Date(asistencia.fecha).toLocaleDateString()}</td>
                    <td>${asistencia.nombreAlumna}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // GESTI√ìN DE GRUPOS
        function crearGrupo() {
            const nombre = document.getElementById('nombreGrupo').value;
            const horario = document.getElementById('horarioGrupo').value;
            const descripcion = document.getElementById('descripcionGrupo').value;

            if (!nombre) {
                alert('Por favor ingrese el nombre del grupo');
                return;
            }

            const grupo = {
                id: idGrupo++,
                nombre,
                horario: horario || '',
                descripcion: descripcion || ''
            };

            grupos.push(grupo);
            guardarDatos();

            document.getElementById('nombreGrupo').value = '';
            document.getElementById('horarioGrupo').value = '';
            document.getElementById('descripcionGrupo').value = '';

            actualizarTodo();
            mostrarAlerta('Grupo creado exitosamente', 'success');
        }

        function actualizarListaGrupos() {
            const container = document.getElementById('listaGrupos');
            container.innerHTML = '';

            if (grupos.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; text-align: center; padding: 20px;">No hay grupos registrados a√∫n.</p>';
                return;
            }

            grupos.forEach(grupo => {
                const alumasDelGrupo = alumnas.filter(a => a.grupoId === grupo.id);
                
                const grupoCard = document.createElement('div');
                grupoCard.className = 'grupo-card';
                grupoCard.innerHTML = `
                    <div class="grupo-header">
                        <div class="grupo-nombre">${grupo.nombre}</div>
                        <div>
                            <button class="btn btn-primary" onclick="abrirModalEditarGrupo(${grupo.id})">Editar</button>
                            <button class="btn btn-danger" onclick="eliminarGrupo(${grupo.id})">Eliminar</button>
                        </div>
                    </div>
                    <div class="grupo-info">
                        <strong>Horario:</strong> ${grupo.horario || 'No especificado'}
                    </div>
                    ${grupo.descripcion ? `<div class="grupo-info"><strong>Descripci√≥n:</strong> ${grupo.descripcion}</div>` : ''}
                    <div class="grupo-info">
                        <strong>Alumnas inscritas:</strong> ${alumasDelGrupo.length}
                    </div>
                    ${alumasDelGrupo.length > 0 ? `
                        <div class="grupo-alumnas">
                            ${alumasDelGrupo.map(a => `<span class="alumna-item">${a.nombre}</span>`).join('')}
                        </div>
                    ` : ''}
                `;
                container.appendChild(grupoCard);
            });
        }

        function abrirModalEditarGrupo(id) {
            const grupo = grupos.find(g => g.id === id);
            if (!grupo) return;

            document.getElementById('editarGrupoId').value = grupo.id;
            document.getElementById('editarNombreGrupo').value = grupo.nombre;
            document.getElementById('editarHorarioGrupo').value = grupo.horario;
            document.getElementById('editarDescripcionGrupo').value = grupo.descripcion;

            // Crear checkboxes de alumnas
            const checkboxContainer = document.getElementById('checkboxAlumnas');
            checkboxContainer.innerHTML = '';

            alumnas.forEach(alumna => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                
                const checked = alumna.grupoId === grupo.id ? 'checked' : '';
                
                div.innerHTML = `
                    <label>
                        <input type="checkbox" value="${alumna.id}" ${checked}>
                        ${alumna.nombre} (${alumna.edad} a√±os)
                    </label>
                `;
                checkboxContainer.appendChild(div);
            });

            document.getElementById('modalEditarGrupo').classList.add('active');
        }

        function cerrarModalGrupo() {
            document.getElementById('modalEditarGrupo').classList.remove('active');
        }

        function guardarEdicionGrupo() {
            const id = parseInt(document.getElementById('editarGrupoId').value);
            const nombre = document.getElementById('editarNombreGrupo').value;
            const horario = document.getElementById('editarHorarioGrupo').value;
            const descripcion = document.getElementById('editarDescripcionGrupo').value;

            if (!nombre) {
                alert('El nombre del grupo es obligatorio');
                return;
            }

            const grupo = grupos.find(g => g.id === id);
            if (!grupo) return;

            grupo.nombre = nombre;
            grupo.horario = horario;
            grupo.descripcion = descripcion;

            // Actualizar alumnas del grupo
            const checkboxes = document.querySelectorAll('#checkboxAlumnas input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                const alumnaId = parseInt(checkbox.value);
                const alumna = alumnas.find(a => a.id === alumnaId);
                
                if (checkbox.checked) {
                    alumna.grupoId = id;
                } else if (alumna.grupoId === id) {
                    alumna.grupoId = null;
                }
            });

            guardarDatos();
            cerrarModalGrupo();
            actualizarTodo();
            mostrarAlerta('Grupo actualizado exitosamente', 'success');
        }

        function eliminarGrupo(id) {
            if (confirm('¬øEst√° seguro de eliminar este grupo? Las alumnas no se eliminar√°n, solo se desasignar√°n del grupo.')) {
                grupos = grupos.filter(g => g.id !== id);
                
                // Desasignar alumnas del grupo eliminado
                alumnas.forEach(alumna => {
                    if (alumna.grupoId === id) {
                        alumna.grupoId = null;
                    }
                });

                guardarDatos();
                actualizarTodo();
                mostrarAlerta('Grupo eliminado', 'success');
            }
        }

        // GESTI√ìN DE MENSUALIDADES
        function registrarMensualidad() {
            const alumnaId = parseInt(document.getElementById('alumnaMensualidad').value);
            const periodo = document.getElementById('periodoMensualidad').value;
            const monto = parseFloat(document.getElementById('montoMensualidad').value);
            const fecha = document.getElementById('fechaMensualidad').value;

            if (!alumnaId || !periodo || !monto || !fecha) {
                alert('Por favor complete todos los campos');
                return;
            }

            const alumna = alumnas.find(a => a.id === alumnaId);

            const mensualidad = {
                id: Date.now(), // ID √∫nico para cada mensualidad
                alumnaId,
                nombreAlumna: alumna.nombre,
                periodo,
                monto,
                fecha
            };

            mensualidades.push(mensualidad);
            guardarDatos();
            
            document.getElementById('periodoMensualidad').value = '';
            document.getElementById('montoMensualidad').value = '';
            
            actualizarListaMensualidades();
            mostrarHistorialPagos();
            mostrarAlerta('Pago de mensualidad registrado', 'success');
        }

        function actualizarListaMensualidades() {
            const tbody = document.getElementById('listaMensualidades');
            tbody.innerHTML = '';

            const mensualidadesOrdenadas = [...mensualidades].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            mensualidadesOrdenadas.forEach(mensualidad => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${mensualidad.nombreAlumna}</td>
                    <td>${mensualidad.periodo}</td>
                    <td>$${mensualidad.monto.toFixed(2)}</td>
                    <td>${new Date(mensualidad.fecha).toLocaleDateString()}</td>
                    <td><span class="badge badge-success">Pagado</span></td>
                    <td>
                        <button class="btn btn-primary" onclick="regenerarTicketMensualidad(${mensualidad.id || 0})">
                            üé´ Ticket
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function mostrarHistorialPagos() {
            const alumnaId = parseInt(document.getElementById('alumnaMensualidad').value);
            
            if (!alumnaId) {
                document.getElementById('historialPagosCard').style.display = 'none';
                return;
            }

            const alumna = alumnas.find(a => a.id === alumnaId);
            const pagosAlumna = mensualidades.filter(m => m.alumnaId === alumnaId);

            document.getElementById('nombreAlumnaHistorial').textContent = alumna.nombre;
            document.getElementById('historialPagosCard').style.display = 'block';

            const historialDiv = document.getElementById('historialPagos');
            historialDiv.innerHTML = '';

            if (pagosAlumna.length === 0) {
                historialDiv.innerHTML = '<p style="color: #6c757d;">No hay pagos registrados para esta alumna.</p>';
                return;
            }

            const tabla = document.createElement('table');
            tabla.innerHTML = `
                <thead>
                    <tr>
                        <th>Periodo</th>
                        <th>Monto</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    ${pagosAlumna.map(p => `
                        <tr>
                            <td>${p.periodo}</td>
                            <td>$${p.monto.toFixed(2)}</td>
                            <td>${new Date(p.fecha).toLocaleDateString()}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;

            const total = pagosAlumna.reduce((sum, p) => sum + p.monto, 0);
            historialDiv.innerHTML = `
                <p><strong>Total de mensualidades pagadas:</strong> ${pagosAlumna.length}</p>
                <p><strong>Total pagado:</strong> $${total.toFixed(2)}</p>
            `;
            historialDiv.appendChild(tabla);
        }

        // GESTI√ìN DE PRODUCTOS
        function agregarProducto() {
            const nombre = document.getElementById('nombreProducto').value;
            const precio = parseFloat(document.getElementById('precioProducto').value);
            const stock = parseInt(document.getElementById('stockProducto').value);

            if (!nombre || !precio || !stock) {
                alert('Por favor complete todos los campos');
                return;
            }

            const producto = {
                id: idProducto++,
                nombre,
                precio,
                stock
            };

            productos.push(producto);
            guardarDatos();
            
            document.getElementById('nombreProducto').value = '';
            document.getElementById('precioProducto').value = '';
            document.getElementById('stockProducto').value = '';
            
            actualizarListaProductos();
            actualizarSelectProductos();
            mostrarAlerta('Producto agregado al inventario', 'success');
        }

        function eliminarProducto(id) {
            if (confirm('¬øEst√° seguro de eliminar este producto?')) {
                productos = productos.filter(p => p.id !== id);
                guardarDatos();
                actualizarListaProductos();
                actualizarSelectProductos();
                mostrarAlerta('Producto eliminado', 'success');
            }
        }

        function actualizarListaProductos() {
            const tbody = document.getElementById('listaProductos');
            tbody.innerHTML = '';

            productos.forEach(producto => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${producto.nombre}</td>
                    <td>$${producto.precio.toFixed(2)}</td>
                    <td>${producto.stock}</td>
                    <td>
                        <button class="btn btn-danger" onclick="eliminarProducto(${producto.id})">Eliminar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function actualizarSelectProductos() {
            const select = document.getElementById('productoVenta');
            const valorActual = select.value;
            select.innerHTML = '<option value="">-- Seleccione un producto --</option>';
            
            productos.forEach(producto => {
                if (producto.stock > 0) {
                    const option = document.createElement('option');
                    option.value = producto.id;
                    option.textContent = `${producto.nombre} - $${producto.precio} (Stock: ${producto.stock})`;
                    select.appendChild(option);
                }
            });
            
            select.value = valorActual;
        }

        function registrarVenta() {
            const productoId = parseInt(document.getElementById('productoVenta').value);
            const alumnaId = parseInt(document.getElementById('alumnaVenta').value) || null;
            const cantidad = parseInt(document.getElementById('cantidadVenta').value);
            const fecha = document.getElementById('fechaVenta').value;

            if (!productoId || !cantidad || !fecha) {
                alert('Por favor complete todos los campos obligatorios');
                return;
            }

            const producto = productos.find(p => p.id === productoId);
            
            if (producto.stock < cantidad) {
                alert('Stock insuficiente');
                return;
            }

            const venta = {
                id: Date.now(), // ID √∫nico para cada venta
                fecha,
                productoId,
                nombreProducto: producto.nombre,
                cantidad,
                precioUnitario: producto.precio,
                total: producto.precio * cantidad,
                alumnaId,
                nombreAlumna: alumnaId ? alumnas.find(a => a.id === alumnaId).nombre : 'Sin alumna'
            };

            ventas.push(venta);
            
            // Actualizar stock
            producto.stock -= cantidad;
            
            guardarDatos();
            
            document.getElementById('cantidadVenta').value = '1';
            
            actualizarListaProductos();
            actualizarSelectProductos();
            actualizarListaVentas();
            mostrarAlerta('Venta registrada exitosamente', 'success');
        }

        function actualizarListaVentas() {
            const tbody = document.getElementById('listaVentas');
            tbody.innerHTML = '';

            const ventasOrdenadas = [...ventas].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));

            ventasOrdenadas.forEach(venta => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${new Date(venta.fecha).toLocaleDateString()}</td>
                    <td>${venta.nombreProducto}</td>
                    <td>${venta.cantidad}</td>
                    <td>$${venta.total.toFixed(2)}</td>
                    <td>${venta.nombreAlumna}</td>
                    <td>
                        <button class="btn btn-primary" onclick="regenerarTicketVenta(${venta.id || 0})">
                            üé´ Ticket
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // REPORTES
        function actualizarReportes() {
            // Estad√≠sticas generales
            document.getElementById('totalAlumnas').textContent = alumnas.length;
            
            const totalMensualidades = mensualidades.reduce((sum, m) => sum + m.monto, 0);
            document.getElementById('totalMensualidades').textContent = '$' + totalMensualidades.toFixed(2);
            
            const totalVentas = ventas.reduce((sum, v) => sum + v.total, 0);
            document.getElementById('totalVentas').textContent = '$' + totalVentas.toFixed(2);
            
            document.getElementById('totalIngresos').textContent = '$' + (totalMensualidades + totalVentas).toFixed(2);

            // Reporte de pagos
            const reportePagos = document.getElementById('reportePagos');
            reportePagos.innerHTML = '';

            alumnas.forEach(alumna => {
                const pagosAlumna = mensualidades.filter(m => m.alumnaId === alumna.id);
                const totalPagado = pagosAlumna.reduce((sum, p) => sum + p.monto, 0);
                const ultimoPago = pagosAlumna.length > 0 
                    ? new Date(Math.max(...pagosAlumna.map(p => new Date(p.fecha)))).toLocaleDateString()
                    : 'Sin pagos';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${alumna.nombre}</td>
                    <td>${pagosAlumna.length}</td>
                    <td>${ultimoPago}</td>
                    <td>$${totalPagado.toFixed(2)}</td>
                `;
                reportePagos.appendChild(tr);
            });

            // Reporte de asistencias
            const reporteAsistencias = document.getElementById('reporteAsistencias');
            reporteAsistencias.innerHTML = '';

            alumnas.forEach(alumna => {
                const asistenciasAlumna = asistencias.filter(a => a.alumnaId === alumna.id);
                const ultimaAsistencia = asistenciasAlumna.length > 0
                    ? new Date(Math.max(...asistenciasAlumna.map(a => new Date(a.fecha)))).toLocaleDateString()
                    : 'Sin asistencias';

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${alumna.nombre}</td>
                    <td>${asistenciasAlumna.length}</td>
                    <td>${ultimaAsistencia}</td>
                `;
                reporteAsistencias.appendChild(tr);
            });
        }

        function mostrarAlerta(mensaje, tipo) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${tipo === 'success' ? 'success' : 'error'}`;
            alertDiv.textContent = mensaje;
            
            const content = document.querySelector('.content');
            content.insertBefore(alertDiv, content.firstChild);
            
            setTimeout(() => alertDiv.remove(), 3000);
        }

        function actualizarTodo() {
            actualizarListaAlumnas();
            actualizarSelectsAlumnas();
            actualizarListaAsistencia();
            actualizarListaMensualidades();
            actualizarListaProductos();
            actualizarSelectProductos();
            actualizarListaVentas();
            actualizarListaGrupos();
        }

        // GESTI√ìN DE LOGO
        function cargarLogo(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                logoAcademia = e.target.result;
                guardarDatos();
                mostrarLogoPreview();
                mostrarAlerta('Logo cargado exitosamente', 'success');
            };
            reader.readAsDataURL(file);
        }

        function mostrarLogoPreview() {
            const container = document.getElementById('logoPreviewContainer');
            if (logoAcademia) {
                container.innerHTML = `
                    <img src="${logoAcademia}" class="logo-preview" alt="Logo de la academia">
                    <br>
                    <button class="btn btn-danger" onclick="eliminarLogo()" style="margin-top: 10px;">Eliminar Logo</button>
                `;
            } else {
                container.innerHTML = '<p style="color: #6c757d;">No hay logo cargado</p>';
            }
        }

        function eliminarLogo() {
            if (confirm('¬øEst√° seguro de eliminar el logo?')) {
                logoAcademia = null;
                guardarDatos();
                mostrarLogoPreview();
                mostrarAlerta('Logo eliminado', 'success');
            }
        }

        // GENERACI√ìN DE TICKETS
        function generarTicketMensualidad() {
            const alumnaId = parseInt(document.getElementById('alumnaMensualidad').value);
            const periodo = document.getElementById('periodoMensualidad').value;
            const monto = parseFloat(document.getElementById('montoMensualidad').value);
            const fecha = document.getElementById('fechaMensualidad').value;

            if (!alumnaId || !periodo || !monto || !fecha) {
                alert('Por favor complete todos los campos para generar el ticket');
                return;
            }

            const alumna = alumnas.find(a => a.id === alumnaId);

            ticketActual = {
                tipo: 'mensualidad',
                alumna: alumna.nombre,
                concepto: `Mensualidad - ${periodo}`,
                monto: monto,
                fecha: fecha
            };

            dibujarTicket();
            document.getElementById('modalTicket').classList.add('active');
        }

        function regenerarTicketMensualidad(mensualidadId) {
            const mensualidad = mensualidades.find(m => m.id === mensualidadId);
            
            if (!mensualidad) {
                alert('No se pudo encontrar la mensualidad');
                return;
            }

            ticketActual = {
                tipo: 'mensualidad',
                alumna: mensualidad.nombreAlumna,
                concepto: `Mensualidad - ${mensualidad.periodo}`,
                monto: mensualidad.monto,
                fecha: mensualidad.fecha
            };

            dibujarTicket();
            document.getElementById('modalTicket').classList.add('active');
        }

        function generarTicketVenta() {
            const productoId = parseInt(document.getElementById('productoVenta').value);
            const alumnaId = parseInt(document.getElementById('alumnaVenta').value) || null;
            const cantidad = parseInt(document.getElementById('cantidadVenta').value);
            const fecha = document.getElementById('fechaVenta').value;

            if (!productoId || !cantidad || !fecha) {
                alert('Por favor complete todos los campos para generar el ticket');
                return;
            }

            const producto = productos.find(p => p.id === productoId);
            const alumna = alumnaId ? alumnas.find(a => a.id === alumnaId) : null;

            ticketActual = {
                tipo: 'venta',
                alumna: alumna ? alumna.nombre : 'Cliente',
                concepto: `${producto.nombre} x${cantidad}`,
                precioUnitario: producto.precio,
                cantidad: cantidad,
                monto: producto.precio * cantidad,
                fecha: fecha
            };

            dibujarTicket();
            document.getElementById('modalTicket').classList.add('active');
        }

        function regenerarTicketVenta(ventaId) {
            const venta = ventas.find(v => v.id === ventaId);
            
            if (!venta) {
                alert('No se pudo encontrar la venta');
                return;
            }

            ticketActual = {
                tipo: 'venta',
                alumna: venta.nombreAlumna,
                concepto: `${venta.nombreProducto} x${venta.cantidad}`,
                precioUnitario: venta.precioUnitario,
                cantidad: venta.cantidad,
                monto: venta.total,
                fecha: venta.fecha
            };

            dibujarTicket();
            document.getElementById('modalTicket').classList.add('active');
        }

        function dibujarTicket() {
            const canvas = document.getElementById('ticketCanvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar tama√±o del ticket
            canvas.width = 400;
            canvas.height = 600;

            // Fondo blanco
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Borde decorativo
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

            let y = 40;

            // Cargar y dibujar logo si existe
            if (logoAcademia) {
                const img = new Image();
                img.onload = function() {
                    const logoHeight = 80;
                    const logoWidth = (img.width / img.height) * logoHeight;
                    const logoX = (canvas.width - logoWidth) / 2;
                    ctx.drawImage(img, logoX, y, logoWidth, logoHeight);
                    
                    y += logoHeight + 20;
                    continuarDibujoTicket(ctx, y);
                };
                img.src = logoAcademia;
            } else {
                // Si no hay logo, dibujar nombre
                ctx.fillStyle = '#667eea';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ü©∞ Academia de Danza', canvas.width / 2, y);
                y += 40;
                continuarDibujoTicket(ctx, y);
            }
        }

        function continuarDibujoTicket(ctx, y) {
            const canvas = ctx.canvas;

            // L√≠nea separadora
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(30, y);
            ctx.lineTo(canvas.width - 30, y);
            ctx.stroke();
            y += 30;

            // T√≠tulo del ticket
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('TICKET DE ' + (ticketActual.tipo === 'mensualidad' ? 'PAGO' : 'VENTA'), canvas.width / 2, y);
            y += 40;

            // Informaci√≥n del ticket
            ctx.fillStyle = '#333333';
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';

            // N√∫mero de ticket
            const numeroTicket = Date.now().toString().slice(-8);
            ctx.fillText('No. Ticket: ' + numeroTicket, 40, y);
            y += 30;

            // Fecha
            const fechaFormateada = new Date(ticketActual.fecha).toLocaleDateString('es-MX', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            ctx.fillText('Fecha: ' + fechaFormateada, 40, y);
            y += 30;

            // Cliente/Alumna
            ctx.fillText('Cliente: ' + ticketActual.alumna, 40, y);
            y += 40;

            // L√≠nea separadora
            ctx.strokeStyle = '#dee2e6';
            ctx.beginPath();
            ctx.moveTo(30, y);
            ctx.lineTo(canvas.width - 30, y);
            ctx.stroke();
            y += 30;

            // Concepto
            ctx.font = 'bold 16px Arial';
            ctx.fillText('CONCEPTO:', 40, y);
            y += 25;
            
            ctx.font = '15px Arial';
            const concepto = ticketActual.concepto;
            const maxWidth = canvas.width - 80;
            const words = concepto.split(' ');
            let line = '';
            
            for (let i = 0; i < words.length; i++) {
                const testLine = line + words[i] + ' ';
                const metrics = ctx.measureText(testLine);
                
                if (metrics.width > maxWidth && i > 0) {
                    ctx.fillText(line, 40, y);
                    line = words[i] + ' ';
                    y += 25;
                } else {
                    line = testLine;
                }
            }
            ctx.fillText(line, 40, y);
            y += 40;

            // Si es venta, mostrar detalles
            if (ticketActual.tipo === 'venta') {
                ctx.font = '14px Arial';
                ctx.fillText('Precio unitario: $' + ticketActual.precioUnitario.toFixed(2), 40, y);
                y += 25;
                ctx.fillText('Cantidad: ' + ticketActual.cantidad, 40, y);
                y += 35;
            }

            // L√≠nea separadora
            ctx.strokeStyle = '#dee2e6';
            ctx.beginPath();
            ctx.moveTo(30, y);
            ctx.lineTo(canvas.width - 30, y);
            ctx.stroke();
            y += 30;

            // Total
            ctx.fillStyle = '#667eea';
            ctx.font = 'bold 24px Arial';
            ctx.fillText('TOTAL:', 40, y);
            
            ctx.textAlign = 'right';
            ctx.fillText('$' + ticketActual.monto.toFixed(2), canvas.width - 40, y);
            y += 50;

            // L√≠nea separadora
            ctx.strokeStyle = '#dee2e6';
            ctx.beginPath();
            ctx.moveTo(30, y);
            ctx.lineTo(canvas.width - 30, y);
            ctx.stroke();
            y += 30;

            // Mensaje de agradecimiento
            ctx.fillStyle = '#666666';
            ctx.font = 'italic 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('¬°Gracias por su preferencia!', canvas.width / 2, y);
            y += 25;
            
            const ahora = new Date().toLocaleString('es-MX');
            ctx.font = '12px Arial';
            ctx.fillText('Impreso: ' + ahora, canvas.width / 2, y);
        }

        function cerrarModalTicket() {
            document.getElementById('modalTicket').classList.remove('active');
        }

        function descargarTicket() {
            const canvas = document.getElementById('ticketCanvas');
            const link = document.createElement('a');
            const numeroTicket = Date.now().toString().slice(-8);
            link.download = `ticket_${numeroTicket}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            mostrarAlerta('Ticket descargado exitosamente', 'success');
        }

        function compartirWhatsApp() {
            const canvas = document.getElementById('ticketCanvas');
            canvas.toBlob(function(blob) {
                const file = new File([blob], 'ticket.png', { type: 'image/png' });
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Ticket de Compra',
                        text: `Ticket de ${ticketActual.tipo} - Academia de Danza`,
                        files: [file]
                    }).then(() => {
                        mostrarAlerta('Compartido exitosamente', 'success');
                    }).catch((error) => {
                        console.log('Error al compartir:', error);
                        compartirWhatsAppAlternativo();
                    });
                } else {
                    compartirWhatsAppAlternativo();
                }
            }, 'image/png');
        }

        function compartirWhatsAppAlternativo() {
            // M√©todo alternativo: generar enlace de WhatsApp con texto
            const mensaje = `*Ticket de ${ticketActual.tipo === 'mensualidad' ? 'Pago' : 'Venta'}*%0A%0A` +
                          `Cliente: ${ticketActual.alumna}%0A` +
                          `Concepto: ${ticketActual.concepto}%0A` +
                          `Total: $${ticketActual.monto.toFixed(2)}%0A` +
                          `Fecha: ${new Date(ticketActual.fecha).toLocaleDateString()}%0A%0A` +
                          `Academia de Danza`;
            
            const urlWhatsApp = `https://wa.me/?text=${mensaje}`;
            window.open(urlWhatsApp, '_blank');
            
            alert('Nota: En dispositivos m√≥viles, primero descarga el ticket y luego comp√°rtelo manualmente por WhatsApp para incluir la imagen.');
        }
    </script>
</body>
</html>
